@using Wyam.Core.Helpers

@{
	string currentFolder = new string(Model.Get<string>("FileRelative", string.Empty).TakeWhile(x => x != '\\' && x != '/').ToArray());
    foreach(IDocument childDoc in AllDocuments.Where(x => x.Metadata.ContainsKey("FileRelative")
	        && !x.Metadata.Of<string>()["FileRelative"].EndsWith("index.md") 
	        && !x.Metadata.Of<string>()["FileRelative"].EndsWith("index.cshtml") 
	        && x.Metadata.Of<string>()["FileRelative"].StartsWith(currentFolder))
	    .OrderBy(x => x.Metadata.Get<int>("Order", 1000))
	    .ThenBy(x => x.Metadata.Get<string>("Title")))
	{
		<h3><strong><a href="/@PathHelper.RemoveExtension(childDoc.Metadata.Get<string>("FileRelative").Replace("\\", "/"))">@(childDoc.Metadata.Get<string>("Title", childDoc.Metadata.Get<string>("FileBase")))</a></strong></h3>
		if(childDoc.Metadata.ContainsKey("Description"))
		{
			<p>@(childDoc.Metadata.Get<string>("Description"))</p>
		}
	}
}